################################################################################
# Unified .env.example for wedding_dream backend
# Copy to .env and fill in secrets. NEVER commit real credentials.
################################################################################

########################################
# Core Django
########################################
SECRET_KEY=change-me-dev
DEBUG=1
DJANGO_SETTINGS_MODULE=wedding_dream.settings.dev
ALLOWED_HOSTS=127.0.0.1,localhost

########################################
# Database (choose ONE of the sections)
########################################
# 1. Internal Postgres via docker-compose services
POSTGRES_DB=wedding_dream
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
# Use Postgres in dev (overrides SQLite fallback in dev.py)
DEV_DATABASE_URL=postgres://postgres:postgres@db:5432/wedding_dream

# 2. Supabase (pooled connection) - replace YOUR-PASSWORD
# Components documented for clarity; primary usage is DATABASE_URL.
SUPABASE_DB_HOST=aws-1-eu-north-1.pooler.supabase.com
SUPABASE_DB_PORT=6543
SUPABASE_DB_NAME=postgres
SUPABASE_DB_USER=postgres.pqqrhxvignnexbtbyali
SUPABASE_DB_PASSWORD=YOUR-SUPABASE-PASSWORD
# Uncomment to use Supabase db instead of internal Postgres
# DATABASE_URL=postgres://${SUPABASE_DB_USER}:${SUPABASE_DB_PASSWORD}@${SUPABASE_DB_HOST}:${SUPABASE_DB_PORT}/${SUPABASE_DB_NAME}

########################################
# Redis / Valkey (Channels, Cache, Celery)
########################################
# Option A: Internal docker compose Redis
REDIS_URL=redis://redis:6379/0
CACHE_REDIS_URL=redis://redis:6379/1
CELERY_BROKER_URL=redis://redis:6379/2
CELERY_RESULT_BACKEND=redis://redis:6379/3

# Option B: External managed Valkey/Redis over TLS (Aiven example)
EXTERNAL_REDIS_HOST=valkey-eb5bb02-seudsahm1-portfolio.k.aivencloud.com
EXTERNAL_REDIS_PORT=23717
EXTERNAL_REDIS_USER=default
EXTERNAL_REDIS_PASSWORD=YOUR-VALKEY-PASSWORD
# rediss (TLS) URLs (uncomment to activate)
# REDIS_URL=rediss://${EXTERNAL_REDIS_USER}:${EXTERNAL_REDIS_PASSWORD}@${EXTERNAL_REDIS_HOST}:${EXTERNAL_REDIS_PORT}/0
# CACHE_REDIS_URL=rediss://${EXTERNAL_REDIS_USER}:${EXTERNAL_REDIS_PASSWORD}@${EXTERNAL_REDIS_HOST}:${EXTERNAL_REDIS_PORT}/1
# CELERY_BROKER_URL=rediss://${EXTERNAL_REDIS_USER}:${EXTERNAL_REDIS_PASSWORD}@${EXTERNAL_REDIS_HOST}:${EXTERNAL_REDIS_PORT}/2
# CELERY_RESULT_BACKEND=rediss://${EXTERNAL_REDIS_USER}:${EXTERNAL_REDIS_PASSWORD}@${EXTERNAL_REDIS_HOST}:${EXTERNAL_REDIS_PORT}/3

########################################
# WebSockets (Channels limits & origins)
########################################
WS_ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
WS_CONN_MAX_PER_MINUTE=120
WS_MSG_MAX_PER_MINUTE=240

########################################
# CORS / CSRF
########################################
CORS_ALLOW_ALL_ORIGINS=1
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
CORS_ALLOWED_ORIGIN_REGEXES=
CORS_ALLOW_CREDENTIALS=1
CSRF_TRUSTED_ORIGINS=

########################################
# Email (Dev + Prod)
########################################
# Dev console backend (simple):
DEV_EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
# Override for SMTP dev (optional)
DEV_EMAIL_HOST=
DEV_EMAIL_PORT=587
DEV_EMAIL_USE_TLS=1
DEV_EMAIL_HOST_USER=
DEV_EMAIL_HOST_PASSWORD=

# Production SMTP
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.sendgrid.net
EMAIL_PORT=587
EMAIL_USE_TLS=1
EMAIL_HOST_USER=apikey
EMAIL_HOST_PASSWORD=
DEFAULT_FROM_EMAIL=noreply@example.com

########################################
# Storage (Media)
########################################
MEDIA_STORAGE_BACKEND=local  # or supabase
SUPABASE_URL=
SUPABASE_BUCKET=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
# Supabase object storage (S3-compatible) additional settings
SUPABASE_S3_ENDPOINT=https://pqqrhxvignnexbtbyali.storage.supabase.co/storage/v1/s3
SUPABASE_REGION=eu-north-1

########################################
# Sentry (optional)
########################################
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.0
SENTRY_PROFILES_SAMPLE_RATE=0.0

########################################
# Security / HTTPS (mostly prod)
########################################
SECURE_SSL_REDIRECT=1
SECURE_REDIRECT_EXEMPT=^health/?$
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=1
SECURE_HSTS_PRELOAD=1
USE_X_FORWARDED_HOST=1
USE_X_FORWARDED_PORT=1
SECURE_CONTENT_TYPE_NOSNIFF=1
SECURE_REFERRER_POLICY=same-origin
X_FRAME_OPTIONS=DENY
SECURE_CROSS_ORIGIN_OPENER_POLICY=same-origin
SESSION_COOKIE_HTTPONLY=1
SESSION_COOKIE_SAMESITE=Lax
CSRF_COOKIE_HTTPONLY=1
CSRF_COOKIE_SAMESITE=Lax

########################################
# Performance thresholds
########################################
SLOW_REQUEST_THRESHOLD_MS=1000
SLOW_DB_QUERY_MS=200
CACHE_TTL=300

########################################
# Celery task tuning
########################################
CELERY_TASK_ALWAYS_EAGER=0
CELERY_TASK_TIME_LIMIT=300
CELERY_TASK_SOFT_TIME_LIMIT=240
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_PREFETCH_MULTIPLIER=1

########################################
# Placeholders for future expansion
########################################
# SIMPLE_JWT custom lifetimes could go here if overridden.
# Additional feature flags / toggles can be appended below.

################################################################################
# Usage notes
# 1. Pick either internal or external Redis definitions (comment the unused set).
# 2. For Supabase DB, set DATABASE_URL and remove DEV_DATABASE_URL.
# 3. Rotate SECRET_KEY in production and keep DEBUG=0.
# 4. Never commit real passwords / API keys.
################################################################################
